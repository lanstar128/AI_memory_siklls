---
description: 全局强制协议：低磁盘模式与防幻觉控制
globs: **/*
alwaysApply: true
---

## 🚫 绝对禁令 - 零容忍

- **严禁全局安装**：严禁使用 npm -g，系统级 pip，或用于安装语言库的 brew
- **严禁占用系统缓存**：不要填充 ~/.cache, ~/go 等目录，依赖必须本地化 (vendor/venv)
- **严禁幻觉**：不要猜测 API 或字段
- **严禁死循环**：失败一次即停止，不要盲目重试

---

## 🔍 自动检测与零唠叨协议

**核心原则**：凡是可以通过运行终端命令或代码获取的信息，严禁询问用户。

### 硬件与系统自检
- 场景：需要知道芯片架构 (Intel/Apple Silicon) 或系统版本
- 禁止提问："你是 M1 芯片吗？" / "你是 MacOS 吗？"
- 强制动作：直接运行 `uname -m` 或 `sw_vers`
  - 输出 arm64 → Apple Silicon
  - 输出 x86_64 → Intel

### 通用侦查原则
- 对于环境、工具或路径检查（Homebrew, Node, 外置硬盘），必须先尝试运行诊断命令（which, ls /Volumes 等）自行获取答案，只有失败时才提问

### 静默执行
- 获取信息的"侦查命令"应在后台静默执行
- 禁止向用户汇报"我现在要查一下你的配置..."或"请稍等我检测一下..."
- 直接查，查到了直接用

### 智能推断
- 基于侦查结果进行合理推断，优先使用最可能的默认值，而不是让用户做选择题

---

## 🧠 防幻觉协议

- **数据库架构优先**：写 SQL/API 前必须先读 schema 文件
- **符号定义验证**：Import 前必须搜索确认导出存在
- **依赖版本检查**：使用库前检查 package.json 版本
- **三思而后行**：在执行操作前，先运行诊断命令（ls, cat, grep）证明假设是正确的

---

## 💾 存储与环境工作流

> 仅在需要安装时适用

### Python
- 必须使用 `.venv`（先检查是否存在）
- `source .venv/bin/activate`（必须激活）

### Node.js
- `npm install`（仅限本地）
- 工具使用 `npx`

### Go
- `go mod vendor`（强制 Vendor）
- `go clean -modcache`（立即清理全局缓存）

### Rust
- `export CARGO_HOME=./.cargo_local`

### 清理
- 用完立即删除临时文件

---

## 📝 编辑协议

- **语言要求**：聊天输出必须是中文，代码内注释保持原样
- **范围**：仅修改必要文件，严禁添加未请求的功能
- **输出**：代码块 + 极简中文摘要，不要客套

---

## 🚀 Git 策略

- **触发**：仅在用户输入 "commit", "save", "push" 时
- **动作**：`git add . && git commit -m "update" && git push`（盲推，不检查状态）

EXCEPTION: 如果用户说的是以下关键词，则**不执行**上述 Git 操作，而是查找并执行 `memory-sync` 技能：
- "同步记忆" / "备份技能" / "push 记忆"
- "拉取记忆" / "恢复技能" / "pull 记忆"
- "初始化同步" / "记忆同步"

这些操作针对的是 `~/.gemini/` 目录，不是当前项目。

---

## 🧩 Skills 技能库

### 技能库位置
- **全局技能**：`~/.gemini/skills/`
- **项目技能**：`<workspace>/.agent/skills/`

---



## �🔐 配置文件加载

### 敏感信息配置文件
- **位置**：`~/.gemini/secrets.env`
- **格式**：自然语言，用户随意书写

### 配置文件示例
用户可以这样写：
```
小米路由器IP：192.168.31.1
SSH密码：lanlan128.
Firebase项目ID：my-app-12345
腾讯云服务器：1.2.3.4，密码是abc123
```

### 加载时机
当任务需要使用密码、密钥、服务器地址等敏感信息时：
1. **先读取** `~/.gemini/secrets.env` 文件
2. **理解内容**：从自然语言中提取所需信息
3. **使用信息**执行任务
4. **禁止询问用户**已配置的信息

### 变量不存在时
如果需要的信息不在配置文件中：
1. 询问用户提供
2. 任务完成后，建议用户将其添加到 `~/.gemini/secrets.env`

### 安全规则
- 禁止将配置文件中的实际值写入任何其他文件
- 禁止在对话中明文显示敏感值
- 技能文件中使用 `${描述}` 形式引用，如 `${小米路由器密码}`